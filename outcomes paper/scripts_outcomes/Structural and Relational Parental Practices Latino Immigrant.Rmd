---
title: ""
author: ""
date: ""
output: html_document
---

```{r setup, include=FALSE}

library(here)
library(haven)
library(tidyverse)
library(psych)

options(scipen = 999)
knitr::opts_chunk$set(echo = TRUE)
```

<h2 style="text-align: center;">Exploratory Factor Analysis - Structural and Relational Parental Practices Among Latino Immigran</h2>

```{r, include=FALSE}
parent_w1 <- read_sav(here("outcomes paper/data_outcomes", "primary_parent_w1.sav"))
```

## Homework Involvement (15 items)
Conteste la frecuencia con la que ha hecho lo siguiente para ayudarle a su hija/o con la tarea en los últimos tres meses…  
84	Me aseguré de que tenga un cierto tiempo para hacer la tarea.  
85	Me aseguré de que él / ella tenga un cierto lugar para hacer la tarea.  
86	Me senté con mi joven mientras él / ella hacía su tarea.  
87	Me hice disponible para mi joven cuando tenía preguntas sobre su tarea.  
88	Ayudé a mi joven cuando estaba atascado/a en una tarea.  
89	Ayudé a mi joven a prepararse para los exámenes haciéndole preguntas sobre el tema, etc.  
90	Le di a mi joven incentivos como privilegios especiales, regalos especiales, etc.  
91	Utilicé consecuencias, castigos, acciones disciplinarias.  
92	Le recordé a mi joven que hiciera su tarea.  
93	Comprobé con mi joven para asegurarme de que él / ella hiciera su tarea.  
94	Comprobé y corregí la tarea de mi hija/o.   
95	Comprobé con la maestra/o para asegurarme que mi joven terminó su tarea.   
96	Le ayudé a mi joven acceder a otros recursos (biblioteca, materiales de arte, laboratorio de computación, etc.).  
97	Le ayudé a mi joven practicar habilidades (lectura, revisión, problemas de práctica, etc.).  
98	Limité el ruido y/o las distracciones mientras hacia su tarea.  

```{r}
hw_inv <- parent_w1 %>%
  select(q84, q85, q86, q87, q88, q89, q90, q91, q92, q93, q94, q95, q96, q97, q98)
```

### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(hw_inv)
```
### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(hw_inv)$rho
cortest.bartlett(poly, n = nrow(hw_inv))
```
### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```

### Scree plot
```{r}
scree(hw_inv, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

### EFA using ULS 2 factors
```{r}
factor_test_uls <- fa(hw_inv, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 2) 
factor_test_uls
```


### Removing items with loadings < 0.3  or cross-loading
```{r}
hw_inv_1 <- parent_w1 %>%
  select(q84, q85, q86, q87, q88, q89, q93, q94, q96, q97)
```


### kmo Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(hw_inv_1)
```

### Bartlett’s Test of Sphericity (P < .05)
```{r}
poly <- polychoric(hw_inv_1)$rho
cortest.bartlett(poly, n = nrow(hw_inv_1))
```

### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```

### Scree plot
```{r}
scree(hw_inv_1, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```


### 2nd EFA iteration: 2 factors
```{r}
factor_test_uls <- fa(hw_inv_1, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 2) 
factor_test_uls

fa.diagram(factor_test_uls)
```


### Factor 1: Tutoring homework
86	Me senté con mi joven mientras él / ella hacía su tarea.  
87	Me hice disponible para mi joven cuando tenía preguntas sobre su tarea.  
88	Ayudé a mi joven cuando estaba atascado/a en una tarea.  
89	Ayudé a mi joven a prepararse para los exámenes haciéndole preguntas sobre el tema, etc.  
94	Comprobé y corregí la tarea de mi hija/o.   
96	Le ayudé a mi joven acceder a otros recursos (biblioteca, materiales de arte, laboratorio de computación, etc.).  
97	Le ayudé a mi joven practicar habilidades (lectura, revisión, problemas de práctica, etc.).  
```{r}
hw_inv_fa1 <- parent_w1 %>%
  select(q86, q87, q88, q89, q94, q96, q97)

# alpha
alpha(hw_inv_fa1)
```


### Factor # 2: checking homework
84	Me aseguré de que tenga un cierto tiempo para hacer la tarea.  
85	Me aseguré de que él / ella tenga un cierto lugar para hacer la tarea.  
93	Comprobé con mi joven para asegurarme de que él / ella hiciera su tarea.  
```{r}
hw_inv_fa2 <- parent_w1 %>%
  select(q84, q85, q93)

# alpha
alpha(hw_inv_fa2)
```


## Home Structure 
Los últimos tres meses, he tomado medidas para apoyar a mi joven a...  
23.	… desarrollar un plan para estudiar y hacer la tarea.  
24.	… encontrar formas de involucrarse en las actividades escolares.  
25.	… encontrar maneras de involucrarse en actividades de voluntario/a en la comunidad.  
26.	… hacer metas para el año escolar.  
27.	… cumplir fechas de limite.  
28.	… participar en papeles de liderazgo en la escuela o comunidad.  
29.	… enfocarse en hacer lo mejor posible.  
30.	… desarrollar un horario para completar la tarea y los proyectos escolares a tiempo.  

```{r}
struct <- parent_w1 %>%
  select(q23, q24, q25, q26, q27, q28, q29, q30) 
```


### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(struct)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(struct)$rho
cortest.bartlett(poly, n = nrow(struct))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```

### Scree plot
```{r}
scree(struct, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

## EFA using ULS - 1 factor
```{r}
factor_test_uls <- fa(struct, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
fa.diagram(factor_test_uls)
```

## Factor: Home Structure
```{r}
alpha(struct)
```


## School Involvement
En general, hago un esfuerzo para...
31.	… conocer el personal y la administración de la escuela.  
32.	… conocer al menos uno de los maestros de mi joven.  
33.	… entender las reglas y pólizas de la escuela.  
34.	… informarme sobre mis derechos como padre.  
35.	… aprender sobre el sistema educativo en este estado.  
36.	… entender la diferencia entre obtener un GED, graduarse con un diploma estándar de la escuela secundaria, o con un diploma de una secundaria internacional o con un diploma de Bachillerato Internacional.  
37.	… involucrarse en las actividades escolares, en el salón de clase, y/u otras maneras (por ejemplo, organizaciones de padres, trabajo voluntario, etc.).  
38.	… tener conversaciones con los otros padres para obtener información o aprender acerca de los recursos en la escuela.  
39.	…contactar los otros padres para obtener apoyo.  
40.	…entender la trayectoria hacia la preparación a la universidad y para una carrera.  
41.	… asistir a la conferencia de padres y maestros cuando esté disponible.  

```{r}
scho_inv <- parent_w1 %>%
  select(q31, q32, q33, q34, q35, q36, q37, q38, q39, q40, q41)
```

### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(scho_inv)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(scho_inv)$rho
cortest.bartlett(poly, n = nrow(scho_inv))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F) # item 41 with 37-39 neg corrs.
```

### Scree plot
```{r}
scree(scho_inv, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```


### Removing item with correlations < 0.3
```{r}
scho_inv <- parent_w1 %>%
  select(q31, q32, q33, q34, q35, q36, q37, q38, q39, q40) # removed 41
```


### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(scho_inv)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(scho_inv)$rho
cortest.bartlett(poly, n = nrow(scho_inv))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```

### Scree plot
```{r}
scree(scho_inv, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

### EFA using ULS 2 factors
```{r}
factor_test_uls <- fa(scho_inv, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 2) 
factor_test_uls
fa.diagram(factor_test_uls)
```

### Removing crossloading item  
```{r}
scho_inv <- parent_w1 %>%
  select(q31, q32, q33, q34, q36, q37, q38, q39, q40) # removed 41
```


### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(scho_inv)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(scho_inv)$rho
cortest.bartlett(poly, n = nrow(scho_inv))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```


### Scree plot
```{r}
scree(scho_inv, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

### 2nd EFA iteration 
```{r}
factor_test_uls <- fa(scho_inv, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 2) 
factor_test_uls
fa.diagram(factor_test_uls)
```

### Factor 1: School familiarity
```{r}
scho_inv_fa1 <- parent_w1 %>%
  select(q31, q32, q33, q34)

# alpha
alpha(scho_inv_fa1)
```

### Factor 2: Proactive school enagagement
```{r}
scho_inv_fa2 <- parent_w1 %>%
  select(q36, q37, q38, q39, q40)

# alpha
alpha(scho_inv_fa2)
```


## School belonging
Como madre/padre de esta escuela, siento que soy…  
47.	…parte de una comunidad con el personal de la escuela y los otros padres.  
48.	…tratado/a con respeto, sabiendo que mis opiniones son importantes.  
49.	…cómoda/o preguntando por un traductor y por materiales en español si los necesito.  
50.	… capaz de hablar con maestros o administradores sobre grandes preocupaciones relacionados con mi joven.  
51.	…dedicada/o en creando un ambiente exitoso para todos los jóvenes.  
52.	 …feliz de que mi joven asista a esta escuela.  
53.	…bienvenido/a en la escuela de mi joven.  


```{r}
comfort <- parent_w1 %>%
  select(q47, q48, q49, q50, q51, q52, q53)
```

### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(comfort)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(comfort)$rho
cortest.bartlett(poly, n = nrow(comfort))
```

### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F) # all healthy corrs
```

### Scree plot
```{r}
scree(comfort, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```


### EFA using ULS 2 factors
```{r}
factor_test_uls <- fa(comfort, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
```

## Factor 1: belong
48.	…tratado/a con respeto, sabiendo que mis opiniones son importantes. ____
49.	…cómoda/o preguntando por un traductor y por materiales en español si los necesito. ____
52.	 …feliz de que mi joven asista a esta escuela. ___
53.	…bienvenido/a en la escuela de mi joven. ____
```{r}
comfort_fa1 <- parent_w1 %>%
  select(q48, q49, q52, q53)
# alpha
alpha(comfort_fa1) # 0.86
```

## Factor 2: included (not included in multiple regression analyses)
47.	…parte de una comunidad con el personal de la escuela y los otros padres. ____
50.	… capaz de hablar con maestros o administradores sobre grandes preocupaciones relacionados con mi joven. ___
51.	…dedicada/o en creando un ambiente exitoso para todos los jóvenes. ____

```{r}
comfort_fa2 <- parent_w1 %>%
  select(q47, q50, q51)
# alpha
alpha(comfort_fa2) # 0.70
```



Issues: 
Homework involvement -- low correlations in the first matrix. 

School involvement: given that I took out parallel analysis, I no longer have a reason to donducxt a 2-factor model because scree plot clearly show 1-factor. 


## School endorsement
54.	… esta escuela es un buen lugar para mi joven.  
55.	… el personal de la escuela de mi joven está haciendo cosas buenas por ella / el.  
56.	… la gente en la escuela de mi joven es confiable.  
57.	… la escuela de mi joven hace un buen trabajo preparando a los jóvenes para sus futuros.  

```{r}
endorse <- parent_w1 %>%
  select(q54, q55, q56, q57)
```

### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(endorse)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(endorse)$rho
cortest.bartlett(poly, n = nrow(endorse))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F) # corrs above .90 potentially multicolleniearity
```

### Scree plot
```{r}
scree(endorse, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```
### EFA using ULS 1 factor
```{r}
factor_test_uls <- fa(endorse, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
```

### Removing item Ultra-Heywood case
```{r}
endorse <- parent_w1 %>%
  select(q54, q56, q57) # removed 55
```


### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(endorse)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(endorse)$rho
cortest.bartlett(poly, n = nrow(endorse))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F) # corrs above .90 potentially multicolleniearity
```

### Scree plot
```{r}
scree(endorse, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

### 2nd EFA iteration 
```{r}
factor_test_uls <- fa(endorse, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
fa.diagram(factor_test_uls)
```




## parent-teacher relationship
En esta escuela, siento que hay por lo menos un maestro…  
64.	… que se preocupa por mi joven.  
65.	… quien está interesado en conocerme.  
66.	… con quien me siento/a cómodo/a hablando sobre mi joven.  
67.	… de quien puedo hacer preguntas o hacer sugerencias sobre mi joven.  

```{r}
pt_rel <- parent_w1 %>%
  select(q64, q65, q66, q67)
```


### Kaiser-Meyer-Olkin factor sampling adequacy (> 0.5)
```{r}
KMO(pt_rel)
```


### Bartlett’s Test of Sphericity (p < .05)
```{r}
poly <- polychoric(pt_rel)$rho
cortest.bartlett(poly, n = nrow(pt_rel))
```


### Poly corr matrix
```{r}
cor.plot(poly, numbers = T, upper = F, main = "Polychoric", show.legend = F)
```

```{r}
scree(pt_rel, factors = TRUE, pc = FALSE, main = "Scree plot", hline = NULL, add = FALSE)
```

## EFA using ULS 
```{r}
factor_test_uls <- fa(pt_rel, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
```

### Removing item Ultra-Heywood case
```{r}
pt_rel <- parent_w1 %>%
  select(q64, q65, q67)# removed 66
```


### 2nd EFA iteration 
```{r}
factor_test_uls <- fa(pt_rel, n.obs = 95, rotate = "oblimin", fm = "uls", cor = "poly", nfactors = 1) 
factor_test_uls
fa.diagram(factor_test_uls)
```

Conclusion: EFA not possible with this scale.

